# Visual FaQtory TouchDesigner Integration Contract — v0.3.5-beta
# ═══════════════════════════════════════════════════════════════════════════════
#
# IMPORTANT: TouchDesigner .toe files are BINARY and cannot be created outside
# of TouchDesigner. This file is a TEXT CONTRACT describing the expected
# network layout, operator wiring, and data flow. You must create the .toe
# project manually inside TouchDesigner.
#
# This repo provides the contract, not the binary project.
#
# To build the network:
#   1. Open TouchDesigner
#   2. Drag td_setup.py into the network editor, OR
#   3. Run: exec(open('touchdesigner/td_setup.py').read())
#
# The script will create all operators described below.
#
# ═══════════════════════════════════════════════════════════════════════════════
# NETWORK LAYOUT
# ═══════════════════════════════════════════════════════════════════════════════
#
# ┌──────────────────────────────────────────────────────────────────┐
# │  VIDEO INPUT                                                      │
# │  moviefilein1 (Movie File In TOP)                                 │
# │    → reads live_output/current_frame.jpg                          │
# │    → reload_pulse = True (auto-refresh)                           │
# │    → plays even if AI stalls (shows last good frame)              │
# └────────────┬─────────────────────────────────────────────────────┘
#              ▼
# ┌──────────────────────────────────────────────────────────────────┐
# │  CACHE / BUFFER                                                   │
# │  cache1 (Cache TOP)                                               │
# │    → Buffers frame to decouple read/write timing                  │
# └────────────┬─────────────────────────────────────────────────────┘
#              ▼
# ┌──────────────────────────────────────────────────────────────────┐
# │  COLOR CORRECTION                                                 │
# │  level1 (Level TOP)                                               │
# │    → Brightness, contrast, gamma                                  │
# │  hsvadjust1 (HSV Adjust TOP)                                      │
# │    → Hue shift, saturation boost, value adjust                    │
# └────────────┬─────────────────────────────────────────────────────┘
#              ▼
# ┌──────────────────────────────────────────────────────────────────┐
# │  FEEDBACK LOOP (GPU shader recursion)                             │
# │  feedback1 (Feedback TOP)                                         │
# │    → Feeds previous frame back into composite                     │
# │  composite1 (Composite TOP)                                       │
# │    → Blends current frame with feedback (operand=Add, opacity)    │
# │    → RMS controls feedback opacity (louder → more trails)         │
# └────────────┬─────────────────────────────────────────────────────┘
#              ▼
# ┌──────────────────────────────────────────────────────────────────┐
# │  FX CHAIN                                                        │
# │  displace1 (Displace TOP)                                         │
# │    → Noise-driven displacement (energy → amount)                  │
# │  glitch1 (GLSL TOP) [optional]                                    │
# │    → Chromatic aberration / scan lines on beat                    │
# └────────────┬─────────────────────────────────────────────────────┘
#              ▼
# ┌──────────────────────────────────────────────────────────────────┐
# │  HUD OVERLAY                                                      │
# │  text1 (Text TOP)                                                 │
# │    → Reads now.txt for current prompt display                     │
# │  composite2 (Composite TOP)                                       │
# │    → Overlays text on FX output                                   │
# └────────────┬─────────────────────────────────────────────────────┘
#              ▼
# ┌──────────────────────────────────────────────────────────────────┐
# │  OUTPUT                                                           │
# │  null_out (Null TOP)                                              │
# │    → Final output node                                            │
# │  window1 (Window COMP) [optional]                                 │
# │    → Fullscreen output                                            │
# │  ndisender1 (NDI Out TOP) [optional]                              │
# │    → NDI stream for OBS                                           │
# └──────────────────────────────────────────────────────────────────┘
#
# ═══════════════════════════════════════════════════════════════════════════════
# AUDIO / MIDI CHOPS
# ═══════════════════════════════════════════════════════════════════════════════
#
# audiodevin1 (Audio Device In CHOP)
#   → Captures system audio or loopback
#
# analyze1 (Analyze CHOP)
#   → RMS, peak level from audio
#
# audiofilter1 (Audio Filter CHOP)
#   → Band-pass for kick detection (60-180 Hz)
#
# midiin1 (MIDI In CHOP)
#   → Same controller as sidecar (parallel read is fine)
#
# ═══════════════════════════════════════════════════════════════════════════════
# FX MAPPING
# ═══════════════════════════════════════════════════════════════════════════════
#
# RMS → feedback opacity (0.0-0.8)
# Kick → strobe flash (Level TOP brightness spike)
# MIDI CC → FX depth (displace amount, glitch intensity)
# OSC /visual_faqtory → macro, crowd_active, energy (if OSC enabled)
#
# TD continues running even if AI generation stalls. The Movie File In
# simply shows the last good frame until a new one arrives.
#
